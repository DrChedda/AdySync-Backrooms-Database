---
permalink: /main/editor
---
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Database Editor | Protected</title>
    <link rel="stylesheet" href="{{ '/main/master-style.css' | relative_url }}">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* Keeping your Yellow Top Bar as requested */
        .editor-top-bar { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            background: #111; 
            border-bottom: 3px solid #ffeb3b; /* Your preferred yellow */
            z-index: 10000; 
            padding: 10px 20px; 
            display: none; 
            gap: 15px; 
            align-items: center; 
            flex-wrap: wrap; 
            box-sizing: border-box;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        /* Adjusting Login Overlay to match the blue/black theme */
        #login-overlay { 
            position: fixed; 
            inset: 0; 
            background: radial-gradient(circle, #001529 0%, #000 100%); 
            z-index: 20000; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            flex-direction: column; 
            gap: 15px; 
        }

        /* Styled Inputs to match master-style */
        input[type="email"], input[type="password"], input[type="text"] { 
            padding: 12px; 
            background: rgba(0, 21, 41, 0.8); 
            border: 1px solid var(--accent); 
            color: #00d2ff; 
            width: 250px; 
            font-family: monospace;
            box-shadow: inset 0 0 5px var(--accent-glow);
        }
        
        input:focus { outline: 2px solid #ffeb3b; }

        /* Unified Button Styles */
        .auth-btn { 
            background: #ffeb3b; /* Yellow for primary actions */
            color: black; 
            border: none; 
            padding: 10px 20px; 
            cursor: pointer; 
            font-weight: 800; 
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: transform 0.1s;
        }
        .auth-btn:active { transform: scale(0.95); }
        
        .blue-btn { background: var(--accent); color: white; }
        .save-btn { background: #4CAF50; color: white; }

        /* Content Editable styling */
        [contenteditable="true"] { 
            border: 1px dashed rgba(0, 153, 255, 0.5); 
            transition: border 0.3s;
        }
        [contenteditable="true"]:focus { 
            border: 1px solid #ffeb3b; 
            outline: none; 
            background: rgba(255, 235, 59, 0.05);
        }

        /* ID Switcher Styling */
        .id-switcher { 
            display: flex; 
            align-items: center; 
            gap: 8px; 
            background: rgba(0,0,0,0.4); 
            padding: 5px 10px; 
            border: 1px solid #444; 
        }
        .id-label { 
            color: #ffeb3b; 
            font-size: 11px; 
            font-weight: 900; 
            font-family: monospace;
        }

        body { padding-top: 100px; }
        #signup-extra { display: none; flex-direction: column; gap: 10px; }
    </style>
</head>
<body class="article-page">

    <div id="login-overlay">
        <div style="border: 2px solid var(--accent); padding: 40px; background: rgba(0,0,0,0.8); display: flex; flex-direction: column; align-items: center; gap: 15px; box-shadow: 0 0 20px var(--accent-glow);">
            <h2 style="color:white; font-family: monospace; margin-top: 0; letter-spacing: 4px;">ACCESS RESTRICTED</h2>
            <input type="email" id="email-field" placeholder="DB_USER_EMAIL">
            <input type="password" id="password-field" placeholder="DB_USER_PASS">
            <div id="signup-extra">
                <input type="text" id="key-field" placeholder="CREATION_KEY">
            </div>
            <div style="display: flex; gap: 10px; width: 100%;">
                <button class="auth-btn" id="login-btn" style="flex:1" onclick="window.handleAuth('login')">SIGN IN</button>
                <button class="auth-btn blue-btn" id="signup-btn" onclick="window.toggleSignup()">REGISTER</button>
            </div>
            <p id="auth-status" style="color: #ffeb3b; font-size: 12px; font-family: monospace;"></p>
        </div>
    </div>

    <div class="editor-top-bar" id="editor-ui">
        <div class="id-switcher">
            <span class="id-label">TARGET_ID:</span>
            <input type="text" id="id-input" placeholder="level-0" style="width: 130px; padding: 5px;">
            <button class="auth-btn" style="min-width: 60px; padding: 5px 10px; font-size: 11px;" onclick="window.switchPage()">LOAD</button>
        </div>

        <div class="id-switcher" style="border-color: var(--accent);">
            <span class="id-label" style="color: var(--accent);">IMG_PATH:</span>
            <input type="text" id="img-input" placeholder="level-0.png" style="width: 150px; padding: 5px;" oninput="window.updatePreview(this.value)">
        </div>

        <button class="auth-btn blue-btn" onclick="window.createNewTab()">+ NEW TAB</button>
        <button class="auth-btn save-btn" onclick="window.saveToSupabase()">PUSH CHANGES</button>
        <button class="auth-btn" style="background: #444; color: white;" onclick="window.handleLogout()">LOGOUT</button>
    </div>

    <div class="page-wrapper">
        <div class="level-header-area">
            <div class="image-box">
                <img id="active-image" src="" alt="Preview">
            </div>
            <div class="title-container">
                <div class="title-group">
                    <h1 id="edit-lvl-id" class="level-id" contenteditable="true">Level ID</h1>
                    <h2 id="edit-lvl-name" class="level-name" contenteditable="true">"Level Name"</h2>
                </div>
                <div id="edit-tags" contenteditable="true" class="tags-row"></div>
                <div id="edit-stats" contenteditable="true" class="data-box"></div>
            </div>
        </div>
        
        <div class="information-box">
            <div id="tab-headers" class="tabs-container"></div>
            <div id="tab-contents-container"></div>
        </div>
    </div>

    <script>
        // Setup (Same as previous script but with updated variable names for UI)
        const supabaseUrl = 'https://wmbvsbhbmryhzgktfxfz.supabase.co';
        const supabaseKey = 'sb_publishable_X47RHqCndZ9vdvVT_ZX4Jw_6X7fEHf_';
        const db = window.supabase.createClient(supabaseUrl, supabaseKey);

        const urlParams = new URLSearchParams(window.location.search);
        let CURRENT_ID = urlParams.get('id') || 'level-0';

        window.switchPage = function() {
            const newId = document.getElementById('id-input').value.trim();
            if (newId) {
                CURRENT_ID = newId;
                const newurl = window.location.protocol + "//" + window.location.host + window.location.pathname + '?id=' + CURRENT_ID;
                window.history.pushState({path:newurl},'',newurl);
                window.loadData();
            }
        };

        window.updatePreview = function(val) {
            if (!val) return;

            let finalSrc;
            if (val.startsWith('http')) {
                finalSrc = val;
            } else {
                const cleanPath = val.startsWith('/') ? val : '/' + val;
                
                if (cleanPath.startsWith('/Images/')) {
                    finalSrc = cleanPath;
                } else {
                    finalSrc = '/Images' + cleanPath;
                }
            }

            document.getElementById('active-image').src = finalSrc;
            console.log("Attempting to load image from:", finalSrc);
        };

        window.toggleSignup = function() {
            const extra = document.getElementById('signup-extra');
            if (extra.style.display === 'none' || extra.style.display === '') {
                extra.style.display = 'flex';
                document.getElementById('login-btn').style.display = 'none';
                document.getElementById('signup-btn').innerText = "CONFIRM REGISTRATION";
            } else {
                window.handleAuth('signup');
            }
        };

        window.handleAuth = async function(mode) {
            const email = document.getElementById('email-field').value;
            const password = document.getElementById('password-field').value;
            const creationKey = document.getElementById('key-field').value;
            const statusBox = document.getElementById('auth-status');
            
            if (mode === 'login') {
                const { error } = await db.auth.signInWithPassword({ email, password });
                if (error) statusBox.innerText = "ERROR: " + error.message;
                else window.checkUser();
            } else {
                const { error } = await db.auth.signUp({ 
                    email, password, options: { data: { creation_key: creationKey } }
                });
                if (error) statusBox.innerText = "ERROR: " + error.message;
                else statusBox.innerText = "CHECK EMAIL FOR LINK";
            }
        };

        window.checkUser = async function() {
            const { data: { user } } = await db.auth.getUser();
            if (user) {
                document.getElementById('login-overlay').style.display = 'none';
                document.getElementById('editor-ui').style.display = 'flex';
                document.getElementById('id-input').value = CURRENT_ID;
                window.loadData();
            }
        };

        window.handleLogout = async function() {
            await db.auth.signOut();
            location.reload();
        };

        window.loadData = async function() {
            const { data } = await db.from('levels').select('content').eq('id', CURRENT_ID).single();
            const imgPath = data?.content?.imageFile || `${CURRENT_ID}.png`;
            document.getElementById('img-input').value = imgPath;
            window.updatePreview(imgPath);

            if (data?.content) {
                document.getElementById('edit-lvl-id').innerText = data.content.title || CURRENT_ID;
                document.getElementById('edit-lvl-name').innerText = data.content.name || "";
                document.getElementById('edit-tags').innerHTML = data.content.tagsHtml || "";
                document.getElementById('edit-stats').innerHTML = data.content.statsHtml || "";
                document.getElementById('tab-headers').innerHTML = "";
                document.getElementById('tab-contents-container').innerHTML = "";
                data.content.tabs?.forEach(t => window.createNewTab(t.name, t.content));
            }
        };

        window.saveToSupabase = async function() {
            const tabs = [];
            document.querySelectorAll('.tab-button').forEach((btn, i) => {
                tabs.push({ name: btn.innerText, content: document.querySelectorAll('.tab-content')[i].innerHTML });
            });

            const payload = {
                title: document.getElementById('edit-lvl-id').innerText,
                name: document.getElementById('edit-lvl-name').innerText,
                tagsHtml: document.getElementById('edit-tags').innerHTML,
                statsHtml: document.getElementById('edit-stats').innerHTML,
                imageFile: document.getElementById('img-input').value,
                tabs: tabs
            };

            const { error } = await db.from('levels').upsert({ id: CURRENT_ID, content: payload });
            if (error) alert("Error: " + error.message);
            else alert(`SUCCESS: Data pushed to ${CURRENT_ID}`);
        };

        window.createNewTab = function(name = "New Tab", content = "Edit content...") {
            const id = Date.now();
            const header = document.createElement('div');
            header.className = 'tab-controls';
            header.id = `header-${id}`;
            header.innerHTML = `<button class="tab-button active" contenteditable="true">${name}</button><button class="del-tab" onclick="window.deleteTab('${id}')">âœ•</button>`;
            document.getElementById('tab-headers').appendChild(header);

            const pane = document.createElement('div');
            pane.className = 'tab-content active';
            pane.id = `content-${id}`;
            pane.contentEditable = "true";
            pane.innerHTML = content;
            document.getElementById('tab-contents-container').appendChild(pane);
        };

        window.deleteTab = (id) => { 
            document.getElementById(`header-${id}`)?.remove(); 
            document.getElementById(`content-${id}`)?.remove(); 
        };

        window.checkUser();
    </script>
</body>
</html>